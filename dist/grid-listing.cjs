"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const Z=(s,u,e,M,o,n)=>{const c=Math.max(1,Math.ceil((s+o)/(e*n+o))),I=Math.max(c,Math.floor((s+o)/(e/n+o))),p=Math.max(1,Math.ceil((u+o)/(M*n+o))),T=Math.max(p,Math.floor((u+o)/(M/n+o))),b=o>0?Math.floor(s/o)+1:Number.POSITIVE_INFINITY,R=o>0?Math.floor(u/o)+1:Number.POSITIVE_INFINITY,x=Math.max(1,Math.floor(s)),k=Math.max(1,Math.floor(u)),y=Math.min(I,b,x),h=Math.min(T,R,k);return{cMin:c,cMax:y,rMin:p,rMax:h}},_=(s,u,e,M,o,n={})=>{const c=n.weightSize??1,I=n.weightAR??1,p=n.alpha??1.5,T=e/M,b=Z(s,u,e,M,o,p),R=1,x=1,k=Math.min(b.cMax,n.maxCols??Number.POSITIVE_INFINITY),y=Math.min(b.rMax,n.maxRows??Number.POSITIVE_INFINITY);let h=null;const d=(l,m)=>{if(l<R||m<x||l>k||m>y)return;const g=s-(l-1)*o,z=u-(m-1)*o;if(g<=0||z<=0)return;const f=g/l,v=z/m;if(n.integerBlockSize&&(!Number.isInteger(f)||!Number.isInteger(v))||f<e/p||f>e*p||v<M/p||v>M*p)return;const L=Math.hypot((f-e)/e,(v-M)/M),N=Math.abs(f/v-T)/T,$=c*L+I*N;(!h||$<h.score)&&(h={width:f,height:v,cols:l,rows:m,score:$,sizeError:L,arError:N})};for(let l=b.cMin;l<=k;l++){const m=s-(l-1)*o;if(m<=0)break;const g=m/l;if(g<e/p||g>e*p)continue;const z=(u+o)/(o+g/T),f=new Set;for(let v=-2;v<=2;v++){const L=Math.round(z+v);L>=x&&L<=y&&f.add(L)}f.add(b.rMin),f.add(y);for(const v of f)d(l,v)}if(!h)for(let l=b.cMin;l<=k;l++)for(let m=b.rMin;m<=y;m++)d(l,m);if(!h)throw new Error("No feasible grid found with given settings/tolerance.");return h},W=(s,u,e,M,o)=>{const n=Math.max(1,Math.round(s/e)),c=Math.max(1,Math.round(u/M)),I=s-o*Math.max(0,n-1),p=u-o*Math.max(0,c-1),T=I/n,b=p/c;return{width:T,height:b,cols:n,rows:c}};function tt(){const s=new Map;return{on:(o,n)=>{let c=s.get(o);return c||s.set(o,c=new Set),c.add(n),()=>c.delete(n)},emit:(o,n)=>{const c=s.get(o);c&&[...c].forEach(I=>I(n))},clear:()=>s.clear()}}function et(s){const u=tt(),e=s.gridEl,M=s.measureViewportEl??null,o=s.desiredBlockSize??{width:400,height:300},n=s.gap??10,c=s.fadeOutDurationMs??200,I=s.staggerStepMs??75,p=s.fadeStaggerStepMs??50,T=s.initialResizeDelayFrames??2,b=s.initialScrollDelayMs??1750;let R=[],x=!1,k=!1,y=null,h=null,d,l=0,m,g=null,z=100,f=!1;function v(){U(()=>G())}function L(){const t=document.documentElement.style;t.setProperty("--block-gap",`${n}px`),t.setProperty("--fade-out-duration",`${c}ms`);const a=Math.max(0,b-250);t.setProperty("--header-fade-delay",`${a}ms`)}function N(t,r){if(t<=0){r();return}requestAnimationFrame(()=>N(t-1,r))}function $(t,r){d=_(t,r,o.width,o.height,n),l=1;const a=document.documentElement.style;a.setProperty("--block-width",`${d.width}px`),a.setProperty("--block-height",`${d.height}px`),a.setProperty("--cols",String(d.cols)),a.setProperty("--rows",String(d.rows)),a.setProperty("--block-gap",`${n}px`),a.setProperty("--header-row",`${l}`)}function D(){if(!d)return;e.innerHTML="";const t=document.createElement("div");t.className="row-spacer col-0",e.appendChild(t),R.forEach((a,i)=>{const E=Math.floor(i/d.cols),S=i%d.cols,w=q(a);w.dataset.row=`${E}`,w.dataset.column=`${S}`,w.classList.add(`row-${E}`),w.classList.add(`col-${S}`);const P=(E%2===0?S:d.cols-1-S)*I,X=i*p;w.style.transitionDelay=`${P}ms`,w.style.setProperty("--fade-delay",`${X}ms`),w.classList.add("fade-in"),e.appendChild(w)});const r=Math.ceil(R.length/d.cols)+1;for(let a=0;a<r;a++){const i=document.createElement("div");i.className="snap-block",i.dataset.row=`${a}`,i.style.top=`${a*(d.height+n)}px`,e.appendChild(i)}}function q(t){const r=t.title,i=(Array.isArray(t.thumbnails)?t.thumbnails:[])[0],E=(t.tags||[]).sort((w,C)=>w.localeCompare(C)),S=document.createElement("div");return S.className="block",S.innerHTML=`
      ${i?`<div class="media"><img class="thumb" src="${i}" alt="${r}"></div>`:""}
      <div class="content block-border">
        <div class="info">
          <h3>${r}</h3>
          </div>
          <div class="tags">
            ${E.map(w=>`<div class="tag" data-tag="${w}">${w}</div>`).join("")}
          </div>
      </div>
      <svg class="checker-border" xmlns="http://www.w3.org/2000/svg">
        <rect class="dash black" />
        <rect class="dash white" />
      </svg>
    `,t.href&&S.addEventListener("click",()=>{window.location.href=t.href}),S}function F(){const t=d.height+n,r=Math.round(e.scrollTop/t),a=r+d.rows-2,i=r+l;return{aboveHeader:i-1>=r&&i-1<=a?i-1:void 0,belowHeader:i>=r&&i<=a?i:void 0}}function j(){B(),x=!0,setTimeout(()=>{const t=F();u.emit("initial:scroll:end",t)},500)}function O(){f||u.emit("scroll:start",void 0),f=!0,B()}function A(){if(f){const t=F();u.emit("scroll:end",t)}f=!1}function V(){g&&window.clearTimeout(g),g=window.setTimeout(()=>{A()},z)}function G(){const t=M?.getBoundingClientRect();if(!t){console.warn("[grid] measureViewport element not found");return}$(t.width,t.height),D(),x&&B(),e&&e.scrollHeight>e.clientHeight&&($(e.clientWidth,t.height),D(),x&&B()),k||(k=!0,document.body.classList.add("layout-ready"))}function Y(){const t=M?.getBoundingClientRect();if(!t)return;$(t.width,t.height),e.innerHTML="";const r=document.createElement("div");r.className="row-spacer col-0",e.appendChild(r),y!==null&&window.clearTimeout(y),y=window.setTimeout(()=>{D(),x&&B(),e&&e.scrollHeight>e.clientHeight&&($(e.clientWidth,t.height),D(),x&&B()),y=null},400)}function B(){if(!d)return;const t=d.height+n,a=Math.round(e.scrollTop/t)+l;e.querySelectorAll(".block").forEach(E=>{parseInt(E.dataset.row||"0",10)<a?E.classList.add("above-header"):E.classList.remove("above-header")})}function U(t){const r=Array.from(e.querySelectorAll(".block"));if(r.length===0){t();return}h!==null&&(window.clearTimeout(h),h=null);let a=0;r.forEach(E=>{const S=parseInt(E.dataset.row||"0",10),w=parseInt(E.dataset.column||"0",10),P=(S%2===0?w:d.cols-1-w)*p;E.style.setProperty("--fade-delay",`${P}ms`),E.classList.add("fade-out"),P>a&&(a=P)});const i=a+c+20;h=window.setTimeout(()=>{h=null,t()},i)}function H(){L(),e.addEventListener("scroll",O,{passive:!0}),window.addEventListener("resize",Y),window.addEventListener("popstate",v),m="onscrollend"in window,m?e.addEventListener("scrollend",A):e.addEventListener("scroll",V,{passive:!0})}function J(){u.clear(),e.removeEventListener("scroll",O),window.removeEventListener("resize",Y),window.removeEventListener("popstate",v),m?e.removeEventListener("scrollend",A):(g&&window.clearTimeout(g),e.removeEventListener("scroll",V)),y!==null&&(window.clearTimeout(y),y=null),h!==null&&(window.clearTimeout(h),h=null)}function K(t){R=t,N(T,()=>G()),window.setTimeout(j,b)}return{init:H,destroy:J,setItems:K,events:u}}exports.createGridList=et;exports.findBestBlockSize=_;exports.findNaiveBlockSize=W;

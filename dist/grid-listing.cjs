"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const et=(s,o,h,v,n,r)=>{const x=Math.max(1,Math.ceil((s+n)/(h*r+n))),z=Math.max(x,Math.floor((s+n)/(h/r+n))),w=Math.max(1,Math.ceil((o+n)/(v*r+n))),I=Math.max(w,Math.floor((o+n)/(v/r+n))),S=n>0?Math.floor(s/n)+1:Number.POSITIVE_INFINITY,N=n>0?Math.floor(o/n)+1:Number.POSITIVE_INFINITY,L=Math.max(1,Math.floor(s)),$=Math.max(1,Math.floor(o)),u=Math.min(z,S,L),p=Math.min(I,N,$);return{cMin:x,cMax:u,rMin:w,rMax:p}},j=(s,o,h,v,n,r={})=>{const x=r.weightSize??1,z=r.weightAR??1,w=r.alpha??1.5,I=h/v,S=et(s,o,h,v,n,w),N=1,L=1,$=Math.min(S.cMax,r.maxCols??Number.POSITIVE_INFINITY),u=Math.min(S.rMax,r.maxRows??Number.POSITIVE_INFINITY);let p=null;const T=(d,i)=>{if(d<N||i<L||d>$||i>u)return;const M=s-(d-1)*n,c=o-(i-1)*n;if(M<=0||c<=0)return;const y=M/d,g=c/i;if(r.integerBlockSize&&(!Number.isInteger(y)||!Number.isInteger(g))||y<h/w||y>h*w||g<v/w||g>v*w)return;const k=Math.hypot((y-h)/h,(g-v)/v),B=Math.abs(y/g-I)/I,R=x*k+z*B;(!p||R<p.score)&&(p={width:y,height:g,cols:d,rows:i,score:R,sizeError:k,arError:B})};for(let d=S.cMin;d<=$;d++){const i=s-(d-1)*n;if(i<=0)break;const M=i/d;if(M<h/w||M>h*w)continue;const c=(o+n)/(n+M/I),y=new Set;for(let g=-2;g<=2;g++){const k=Math.round(c+g);k>=L&&k<=u&&y.add(k)}y.add(S.rMin),y.add(u);for(const g of y)T(d,g)}if(!p)for(let d=S.cMin;d<=$;d++)for(let i=S.rMin;i<=u;i++)T(d,i);if(!p)throw new Error("No feasible grid found with given settings/tolerance.");return p},ot=(s,o,h,v,n)=>{const r=Math.max(1,Math.round(s/h)),x=Math.max(1,Math.round(o/v)),z=s-n*Math.max(0,r-1),w=o-n*Math.max(0,x-1),I=z/r,S=w/x;return{width:I,height:S,cols:r,rows:x}};function at(s){const o=s.gridEl,h=s.headerEl??null,v=s.measureViewportEl??null,n=s.desiredBlockSize??{width:400,height:300},r=s.gap??10,x=s.fadeOutDurationMs??200,z=s.staggerStepMs??75,w=s.fadeStaggerStepMs??50,I=s.initialResizeDelayFrames??2,S=s.initialScrollDelayMs??1750,N=s.filterScrollDelayMs??400;let L=[],$=[];const u=new Set;let p=null,T=!1,d=!1,i=null,M=null,c,y=0;const g=()=>O(),k=()=>J(),B=()=>{_(),q(),Y(()=>V())};function R(){const t=document.documentElement.style;t.setProperty("--block-gap",`${r}px`),t.setProperty("--fade-out-duration",`${x}ms`);const a=Math.max(0,S-250);t.setProperty("--header-fade-delay",`${a}ms`)}function G(t,e){if(t<=0){e();return}requestAnimationFrame(()=>G(t-1,e))}function D(t,e){c=j(t,e,n.width,n.height,r),y=1;const a=document.documentElement.style;a.setProperty("--block-width",`${c.width}px`),a.setProperty("--block-height",`${c.height}px`),a.setProperty("--cols",String(c.cols)),a.setProperty("--rows",String(c.rows)),a.setProperty("--block-gap",`${r}px`),a.setProperty("--header-row",`${y}`)}function C(){if(!c)return;o.innerHTML="";const t=document.createElement("div");t.className="row-spacer col-0",o.appendChild(t);const e=L.filter(f=>u.size===0?!0:(f.tags||[]).some(b=>u.has(b)));e.forEach((f,l)=>{const b=Math.floor(l/c.cols),m=l%c.cols,E=H(f);E.dataset.row=`${b}`,E.dataset.column=`${m}`,E.classList.add(`row-${b}`),E.classList.add(`col-${m}`);const W=(b%2===0?m:c.cols-1-m)*z,tt=l*w;E.style.transitionDelay=`${W}ms`,E.style.setProperty("--fade-delay",`${tt}ms`),E.classList.add("fade-in"),o.appendChild(E)});const a=Math.ceil(e.length/c.cols)+1;for(let f=0;f<a;f++){const l=document.createElement("div");l.className="snap-block",l.dataset.row=`${f}`,l.style.top=`${f*(c.height+r)}px`,o.appendChild(l)}}function H(t){const e=t.title,f=(Array.isArray(t.thumbnails)?t.thumbnails:[])[0],l=(t.tags||[]).sort((m,E)=>m.localeCompare(E)),b=document.createElement("div");return b.className="block",b.innerHTML=`
      ${f?`<div class="media"><img class="thumb" src="${f}" alt="${e}"></div>`:""}
      <div class="content block-border">
        <div class="info">
          <h3>${e}</h3>
        </div>
        <div class="tags">
          ${l.map(m=>`<button class="tag${u.has(m)?" active":""}" data-tag="${m}">${m}</button>`).join("")}
        </div>
      </div>
      <svg class="checker-border" xmlns="http://www.w3.org/2000/svg">
        <rect class="dash black" />
        <rect class="dash white" />
      </svg>
    `,t.href&&b.addEventListener("click",()=>{window.location.href=t.href}),b.querySelectorAll(".tag").forEach(m=>{m.addEventListener("click",E=>{E.preventDefault(),E.stopPropagation();const A=m.getAttribute("data-tag");A&&U(A)})}),b}function O(){P(),T=!0}function V(){const t=v?.getBoundingClientRect();if(!t){console.warn("[grid] measureViewport element not found");return}D(t.width,t.height),C(),T&&P(),o&&o.scrollHeight>o.clientHeight&&(D(o.clientWidth,t.height),C(),T&&P()),d||(d=!0,document.body.classList.add("layout-ready"))}function J(){const t=v?.getBoundingClientRect();if(!t)return;D(t.width,t.height),o.innerHTML="";const e=document.createElement("div");e.className="row-spacer col-0",o.appendChild(e),i!==null&&window.clearTimeout(i),i=window.setTimeout(()=>{C(),T&&P(),o&&o.scrollHeight>o.clientHeight&&(D(o.clientWidth,t.height),C(),T&&P()),i=null},400)}function P(){if(!c)return;const t=c.height+r,a=Math.round(o.scrollTop/t)+y;o.querySelectorAll(".block").forEach(l=>{parseInt(l.dataset.row||"0",10)<a?l.classList.add("above-header"):l.classList.remove("above-header")})}function q(){p&&(p.innerHTML="",$.forEach(t=>{const e=document.createElement("button");e.type="button",e.className="tag",e.textContent=t,e.dataset.tag=t,u.has(t)&&e.classList.add("active"),e.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),U(t)}),p.appendChild(e)}))}function U(t){u.has(t)?u.delete(t):u.add(t),q(),T=!1,Y(()=>V()),window.setTimeout(()=>O(),N),K()}function Y(t){const e=Array.from(o.querySelectorAll(".block"));if(e.length===0){t();return}M!==null&&(window.clearTimeout(M),M=null);let a=0;e.forEach(l=>{const b=parseInt(l.dataset.row||"0",10),m=parseInt(l.dataset.column||"0",10),F=(b%2===0?m:c.cols-1-m)*w;l.style.setProperty("--fade-delay",`${F}ms`),l.classList.add("fade-out"),F>a&&(a=F)});const f=a+x+20;M=window.setTimeout(()=>{M=null,t()},f)}function K(){const t=new URLSearchParams(location.search),e=Array.from(u);e.length?t.set("tags",e.join(",")):t.delete("tags");const a=t.toString(),f=a?`${location.pathname}?${a}`:location.pathname;history.pushState(null,"",f)}function _(){u.clear();const e=new URLSearchParams(location.search).get("tags");e&&e.split(",").filter(Boolean).forEach(a=>u.add(a))}function Q(){h&&(p=document.createElement("div"),p.className="tags",h.appendChild(p)),R(),o.addEventListener("scroll",g,{passive:!0}),window.addEventListener("resize",k),window.addEventListener("popstate",B)}function X(){o.removeEventListener("scroll",g),window.removeEventListener("resize",k),window.removeEventListener("popstate",B),i!==null&&(window.clearTimeout(i),i=null),M!==null&&(window.clearTimeout(M),M=null)}function Z(t){L=t,$=Array.from(new Set(L.flatMap(e=>e.tags||[]))).sort((e,a)=>e.localeCompare(a)),_(),q(),G(I,()=>V()),window.setTimeout(()=>O(),S)}return{init:Q,destroy:X,setItems:Z}}exports.createGridList=at;exports.findBestBlockSize=j;exports.findNaiveBlockSize=ot;

"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const W=(s,c,t,M,n,a)=>{const d=Math.max(1,Math.ceil((s+n)/(t*a+n))),I=Math.max(d,Math.floor((s+n)/(t/a+n))),p=Math.max(1,Math.ceil((c+n)/(M*a+n))),T=Math.max(p,Math.floor((c+n)/(M/a+n))),y=n>0?Math.floor(s/n)+1:Number.POSITIVE_INFINITY,B=n>0?Math.floor(c/n)+1:Number.POSITIVE_INFINITY,L=Math.max(1,Math.floor(s)),E=Math.max(1,Math.floor(c)),R=Math.min(I,y,L),f=Math.min(T,B,E);return{cMin:d,cMax:R,rMin:p,rMax:f}},q=(s,c,t,M,n,a={})=>{const d=a.weightSize??1,I=a.weightAR??1,p=a.alpha??1.5,T=t/M,y=W(s,c,t,M,n,p),B=1,L=1,E=Math.min(y.cMax,a.maxCols??Number.POSITIVE_INFINITY),R=Math.min(y.rMax,a.maxRows??Number.POSITIVE_INFINITY);let f=null;const S=(o,u)=>{if(o<B||u<L||o>E||u>R)return;const g=s-(o-1)*n,x=c-(u-1)*n;if(g<=0||x<=0)return;const b=g/o,m=x/u;if(a.integerBlockSize&&(!Number.isInteger(b)||!Number.isInteger(m))||b<t/p||b>t*p||m<M/p||m>M*p)return;const k=Math.hypot((b-t)/t,(m-M)/M),P=Math.abs(b/m-T)/T,N=d*k+I*P;(!f||N<f.score)&&(f={width:b,height:m,cols:o,rows:u,score:N,sizeError:k,arError:P})};for(let o=y.cMin;o<=E;o++){const u=s-(o-1)*n;if(u<=0)break;const g=u/o;if(g<t/p||g>t*p)continue;const x=(c+n)/(n+g/T),b=new Set;for(let m=-2;m<=2;m++){const k=Math.round(x+m);k>=L&&k<=R&&b.add(k)}b.add(y.rMin),b.add(R);for(const m of b)S(o,m)}if(!f)for(let o=y.cMin;o<=E;o++)for(let u=y.rMin;u<=R;u++)S(o,u);if(!f)throw new Error("No feasible grid found with given settings/tolerance.");return f},ee=(s,c,t,M,n)=>{const a=Math.max(1,Math.round(s/t)),d=Math.max(1,Math.round(c/M)),I=s-n*Math.max(0,a-1),p=c-n*Math.max(0,d-1),T=I/a,y=p/d;return{width:T,height:y,cols:a,rows:d}};function te(){const s=new Map;return{on:(n,a)=>{let d=s.get(n);return d||s.set(n,d=new Set),d.add(a),()=>d.delete(a)},emit:(n,a)=>{const d=s.get(n);d&&[...d].forEach(I=>I(a))},clear:()=>s.clear()}}function oe(s){const c=te(),t=s.gridEl,M=s.measureViewportEl??null,n=s.desiredBlockSize??{width:400,height:300},a=s.gap??10,d=s.fadeOutDurationMs??200,I=s.staggerStepMs??75,p=s.fadeStaggerStepMs??50,T=s.initialResizeDelayFrames??2,y=s.initialScrollDelayMs??1750,B=s.additionalSpacerRows??!1;let L=[],E=!1,R=!1,f=null,S=null,o,u=0,g,x=null,b=100,m=!1;function k(){H(()=>Y())}function P(){const e=document.documentElement.style;e.setProperty("--block-gap",`${a}px`),e.setProperty("--fade-out-duration",`${d}ms`);const r=Math.max(0,y-250);e.setProperty("--header-fade-delay",`${r}ms`)}function N(e,i){if(e<=0){i();return}requestAnimationFrame(()=>N(e-1,i))}function D(e,i){o=q(e,i,n.width,n.height,a),u=1;const r=document.documentElement.style;r.setProperty("--block-width",`${o.width}px`),r.setProperty("--block-height",`${o.height}px`),r.setProperty("--cols",String(o.cols)),r.setProperty("--rows",String(o.rows)),r.setProperty("--block-gap",`${a}px`),r.setProperty("--header-row",`${u}`)}function C(){if(!o)return;t.innerHTML="";const e=document.createElement("div");e.className="row-spacer col-0",t.appendChild(e),L.forEach((r,l)=>{const h=Math.floor(l/o.cols),v=l%o.cols,w=j(r);w.dataset.row=`${h}`,w.dataset.column=`${v}`,w.classList.add(`row-${h}`),w.classList.add(`col-${v}`);const z=(h%2===0?v:o.cols-1-v)*I,Z=l*p;w.style.transitionDelay=`${z}ms`,w.style.setProperty("--fade-delay",`${Z}ms`),w.classList.add("fade-in"),t.appendChild(w)});let i=Math.ceil(L.length/o.cols)+1;if(B){const r=o.rows-(u+1),l=Math.max(0,r-1);for(let h=0;h<l;h++){const v=document.createElement("div");v.className=`row-spacer col-${h+i}`,t.appendChild(v)}i+=l}for(let r=0;r<i;r++){const l=document.createElement("div");l.className="snap-block",l.dataset.row=`${r}`,l.style.top=`${r*(o.height+a)}px`,t.appendChild(l)}}function j(e){const i=e.title,l=(Array.isArray(e.thumbnails)?e.thumbnails:[])[0],h=(e.tags||[]).sort((w,O)=>w.localeCompare(O)),v=document.createElement("div");return v.className="block",v.innerHTML=`
      ${l?`<div class="media"><img class="thumb" src="${l}" alt="${i}"></div>`:""}
      <div class="content block-border">
        <div class="info">
          <h3>${i}</h3>
          </div>
          <div class="tags">
            ${h.map(w=>`<div class="tag" data-tag="${w}">${w}</div>`).join("")}
          </div>
      </div>
      <svg class="checker-border" xmlns="http://www.w3.org/2000/svg">
        <rect class="dash black" />
        <rect class="dash white" />
      </svg>
    `,e.href&&v.addEventListener("click",()=>{window.location.href=e.href}),v}function A(){const e=o.height+a,i=Math.round(t.scrollTop/e),r=i+o.rows-2,l=i+u;return{aboveHeader:l-1>=i&&l-1<=r?l-1:void 0,belowHeader:l>=i&&l<=r?l:void 0}}function U(){$(),E=!0,setTimeout(()=>{const e=A();c.emit("initial:scroll:end",e)},500)}function V(){m||c.emit("scroll:start",void 0),m=!0,$()}function F(){if(m){const e=A();c.emit("scroll:end",e)}m=!1}function G(){x&&window.clearTimeout(x),x=window.setTimeout(()=>{F()},b)}function Y(){const e=M?.getBoundingClientRect();if(!e){console.warn("[grid] measureViewport element not found");return}D(e.width,e.height),C(),E&&$(),t&&t.scrollHeight>t.clientHeight&&(D(t.clientWidth,e.height),C(),E&&$()),R||(R=!0,document.body.classList.add("layout-ready")),E&&setTimeout(()=>{c.emit("initial:scroll:end",A())},500)}function _(){const e=M?.getBoundingClientRect();if(!e)return;D(e.width,e.height),t.innerHTML="";const i=document.createElement("div");i.className="row-spacer col-0",t.appendChild(i),f!==null&&window.clearTimeout(f),f=window.setTimeout(()=>{C(),E&&$(),t&&t.scrollHeight>t.clientHeight&&(D(t.clientWidth,e.height),C(),E&&$()),f=null,E&&setTimeout(()=>{c.emit("initial:scroll:end",A())},500)},400)}function $(){if(!o)return;const e=o.height+a,r=Math.round(t.scrollTop/e)+u;t.querySelectorAll(".block").forEach(h=>{parseInt(h.dataset.row||"0",10)<r?h.classList.add("above-header"):h.classList.remove("above-header")})}function H(e){const i=Array.from(t.querySelectorAll(".block"));if(i.length===0){e();return}S!==null&&(window.clearTimeout(S),S=null);let r=0;i.forEach(h=>{const v=parseInt(h.dataset.row||"0",10),w=parseInt(h.dataset.column||"0",10),z=(v%2===0?w:o.cols-1-w)*p;h.style.setProperty("--fade-delay",`${z}ms`),h.classList.add("fade-out"),z>r&&(r=z)});const l=r+d+20;S=window.setTimeout(()=>{S=null,e()},l)}function J(){P(),t.addEventListener("scroll",V,{passive:!0}),window.addEventListener("resize",_),window.addEventListener("popstate",k),g="onscrollend"in window,g?t.addEventListener("scrollend",F):t.addEventListener("scroll",G,{passive:!0})}function K(){c.clear(),t.removeEventListener("scroll",V),window.removeEventListener("resize",_),window.removeEventListener("popstate",k),g?t.removeEventListener("scrollend",F):(x&&window.clearTimeout(x),t.removeEventListener("scroll",G)),f!==null&&(window.clearTimeout(f),f=null),S!==null&&(window.clearTimeout(S),S=null)}function Q(e){L=e,N(T,()=>Y()),window.setTimeout(U,y)}return{init:J,destroy:K,setItems:Q,events:c}}exports.createGridList=oe;exports.findBestBlockSize=q;exports.findNaiveBlockSize=ee;

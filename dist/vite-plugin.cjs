"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const l=require("fs"),c=require("path"),I=["thumbnail.png","thumbnail.jpg","thumbnail.jpeg","thumbnail.webp","thumbnail.gif","thumbnail.mp4","thumbnail.webm"];function v(t,e=t){const n=[];if(!l.existsSync(t))return n;const i=l.readdirSync(t,{withFileTypes:!0});for(const a of i){if(!a.isDirectory())continue;const s=c.join(t,a.name),o=c.join(s,"index.html");l.existsSync(o)&&n.push(s),n.push(...v(s,e))}return n}function w(t){const e=t.match(/<title[^>]*>([\s\S]*?)<\/title>/i);return e?e[1].trim():void 0}function D(t){const e=t.match(/<meta[^>]*name=["']description["'][^>]*content=["']([^"']*)["'][^>]*>/i)||t.match(/<meta[^>]*content=["']([^"']*)["'][^>]*name=["']description["'][^>]*>/i);return e?e[1].trim():void 0}function _(t){const e=t.match(/<meta[^>]*name=["']tags["'][^>]*content=["']([^"']*)["'][^>]*>/i)||t.match(/<meta[^>]*content=["']([^"']*)["'][^>]*name=["']tags["'][^>]*>/i);return e?e[1].split(",").map(n=>n.trim()).filter(Boolean).sort((n,i)=>n.localeCompare(i)):[]}function $(t,e){for(const n of e){const i=c.join(t,n);if(l.existsSync(i))return n}}function F(t,e){const{basePath:n="/",includeHidden:i=!1,thumbnailPatterns:a=I}=e,s=v(t),o=[];for(const r of s){const u=c.relative(t,r),m=c.basename(r),f=m.startsWith("_");if(f&&!i)continue;const p=u.split(/[/\\]/),y=p.length>1?p[0]:"misc",P=c.join(r,"index.html"),d=l.readFileSync(P,"utf-8"),S=w(d),M=D(d),g=_(d),b=$(r,a),h=u.split(/[/\\]/).join(c.posix.sep),T=`${n}${h}/`.replace(/\/+/g,"/"),j=b?`${h}/${b}`.replace(/\\/g,"/"):void 0;o.push({path:h,name:m,group:y,title:S,description:M,tags:g.length>0?g:void 0,thumbnail:j,href:T,hidden:f})}return o.sort((r,u)=>r.path.localeCompare(u.path)),o}function x(t){const e=t.moduleId||"virtual:grid-manifest",n="\0"+e;let i=null,a=null;return{name:"grid-manifest",resolveId(s){if(s===e)return n},load(s){if(s===n){const o=F(t.dir,t);return`export default ${JSON.stringify({items:o},null,2)};`}},configureServer(s){a=s,l.existsSync(t.dir)&&(i=l.watch(t.dir,{recursive:!0},(o,r)=>{if(!r)return;if(r.endsWith("index.html")||r.includes("thumbnail")||o==="rename"){const m=a?.moduleGraph.getModuleById(n);m&&(a?.moduleGraph.invalidateModule(m),a?.ws.send({type:"full-reload",path:"*"}))}}))},buildEnd(){i&&(i.close(),i=null)}}}exports.default=x;exports.gridManifestPlugin=x;

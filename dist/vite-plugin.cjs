"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const u=require("fs"),l=require("path"),T=["thumbnail.png","thumbnail.jpg","thumbnail.jpeg","thumbnail.webp","thumbnail.gif","thumbnail.mp4","thumbnail.webm"];function v(t,e=t){const n=[];if(!u.existsSync(t))return n;const i=u.readdirSync(t,{withFileTypes:!0});for(const a of i){if(!a.isDirectory())continue;const s=l.join(t,a.name),o=l.join(s,"index.html");u.existsSync(o)&&n.push(s),n.push(...v(s,e))}return n}function j(t){const e=t.match(/<title[^>]*>([\s\S]*?)<\/title>/i);return e?e[1].trim():void 0}function w(t){const e=t.match(/<meta[^>]*name=["']description["'][^>]*content=["']([^"']*)["'][^>]*>/i)||t.match(/<meta[^>]*content=["']([^"']*)["'][^>]*name=["']description["'][^>]*>/i);return e?e[1].trim():void 0}function D(t){const e=t.match(/<meta[^>]*name=["']tags["'][^>]*content=["']([^"']*)["'][^>]*>/i)||t.match(/<meta[^>]*content=["']([^"']*)["'][^>]*name=["']tags["'][^>]*>/i);return e?e[1].split(",").map(n=>n.trim()).filter(Boolean).sort((n,i)=>n.localeCompare(i)):[]}function _(t,e){for(const n of e){const i=l.join(t,n);if(u.existsSync(i))return n}}function $(t,e){const{basePath:n="/",includeHidden:i=!1,thumbnailPatterns:a=T}=e,s=v(t),o=[];for(const r of s){const m=l.relative(t,r),c=l.basename(r),d=c.startsWith("_");if(d&&!i)continue;const p=m.split(/[/\\]/),y=p.length>1?p[0]:"misc",P=l.join(r,"index.html"),h=u.readFileSync(P,"utf-8"),S=j(h),I=w(h),g=D(h),b=_(r,a),f=m.split(/[/\\]/).join(l.posix.sep),M=`${n}${f}/`.replace(/\/+/g,"/"),N=b?`${f}/${b}`.replace(/\\/g,"/"):void 0;o.push({path:f,name:c,group:y,title:S,description:I,tags:g.length>0?g:void 0,thumbnail:N,href:M,hidden:d})}return o.sort((r,m)=>{const c=parseInt(r.name,10),d=parseInt(m.name,10);return!isNaN(c)&&!isNaN(d)?c-d:r.path.localeCompare(m.path)}),o}function x(t){const e=t.moduleId||"virtual:grid-manifest",n="\0"+e;let i=null,a=null;return{name:"grid-manifest",resolveId(s){if(s===e)return n},load(s){if(s===n){const o=$(t.dir,t);return`export default ${JSON.stringify({items:o},null,2)};`}},configureServer(s){a=s,u.existsSync(t.dir)&&(i=u.watch(t.dir,{recursive:!0},(o,r)=>{if(!r)return;if(r.endsWith("index.html")||r.includes("thumbnail")||o==="rename"){const c=a?.moduleGraph.getModuleById(n);c&&(a?.moduleGraph.invalidateModule(c),a?.ws.send({type:"full-reload",path:"*"}))}}))},buildEnd(){i&&(i.close(),i=null)}}}exports.default=x;exports.gridManifestPlugin=x;

/**
 * Grid Listing - Core Layout & Animation Styles
 *
 * Requires CSS variables to be defined (import variables.css or define your own):
 * - Layout: --block-width, --block-height, --block-gap, --cols, --rows, --header-row
 * - Timing: --ease, --duration, --fade-in-duration, --fade-out-duration, --hover-transition-duration, --speed
 * - Colors: --block-border-color, --block-background-color, --grid-color-vertical, --grid-color-horizontal
 * - Tags: --tag-*, --tag-header-*, --tag-active-*, --tag-hover-*
 * - Border: --border, --cell, --dash-color-1, --dash-color-2
 */

:root {
  /* layout (set by JS) */
  --rows: 0;
  --cols: 0;
  --block-width: 100vw;
  --block-height: 100vh;
  --block-gap: 10px;
  --header-row: -1; /* What row is the header, that the items 'avoid' */
}

/* Grid-specific styles */
.block-border {
  transition: border-color var(--hover-transition-duration) linear;
  border: 5px solid var(--block-border-color);
}

.tags {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  padding-top: 20px;

  & .tag {
    pointer-events: auto;
    cursor: pointer;
    color: var(--tag-text-color);
    background-color: var(--tag-background-color);
    padding: 5px 10px;
    color: white;

    transition: background-color 150ms linear, color 150ms linear;

    /* &:hover {
      background-color: var(--tag-hover-background-color);
      color: var(--tag-hover-text-color);
    }
    &.active {
      background-color: var(--tag-active-background-color);
      color: var(--tag-active-text-color);
    } */
  }
}

.grid-listing {
  position: relative;
  z-index: 5;
  width: 100%;
  height: 100%;
  gap: var(--block-gap);
  display: flex;
  flex-wrap: wrap;
  align-content: flex-start;

  overflow: auto;
  scrollbar-gutter: stable;
  overscroll-behavior: contain;
  scroll-snap-type: y mandatory;
}

.grid-listing > .block {
  position: relative;
  cursor: pointer;

  width: var(--block-width);
  height: var(--block-height);

  background-color: var(--block-background-color);

  will-change: transform;
  transition: transform var(--duration) var(--ease);

  overflow: hidden;
}

.grid-listing > .snap-block {
  position: absolute;
  width: 0px;
  height: var(--block-height);
  scroll-snap-align: start;
}

/* Full-bleed media fills the card ignoring padding */
.grid-listing > .block .media {
  position: absolute;
  inset: 0;
  z-index: 0;
}

.grid-listing > .block .media img.thumb {
  position: absolute;
  inset: auto;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transform-origin: center center;
}

/* Foreground content sits above media and respects padding */
.grid-listing > .block .content {
  position: relative;
  z-index: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 100%;
  padding: calc(var(--block-gap) * 0.5);
  & h3, & p {
    font-family: 'IBM Plex Mono', monospace;
    font-weight: 400;
    font-style: normal;
    display: inline-block;
    padding: 8px 10px;
    font-size: 12px;
    line-height: 1;
    letter-spacing: 0.02em;
    text-transform: uppercase;
    user-select: none;
    -webkit-user-select: none;
    background-color: black;
    color: white;
  }
}

.grid-listing > .block .content .tags {
  flex-wrap: wrap-reverse;
  align-content: flex-start;
}

/*
.col-0 {
  scroll-snap-align: start;
}
*/

.above-header {
  transform: translateY(calc(-1 * (var(--block-height) + var(--block-gap))));
}

.row-spacer {
  width: 100%;
  height: var(--block-height);
}

.checker-border {
  position: absolute;
  z-index: 10;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: visible; /* avoids clipping stroke that sits half outside */
  opacity: 0;
  transition: opacity var(--hover-transition-duration) linear;
}

/* We size/position the <rect> purely via CSS.
   Inset by half the stroke so the border sits INSIDE the box. */
.checker-border .dash {
  /* Geometry (SVG 2 properties supported in modern browsers) */
  x: calc(var(--border) / 2);
  y: calc(var(--border) / 2);
  width: calc(100% - var(--border));
  height: calc(100% - var(--border));

  /* Stroke styling */
  fill: none;
  stroke-width: var(--border);
  stroke-linecap: butt;
  stroke-dasharray: var(--cell) var(--cell);  /* 10px on, 10px off */
}

/* Two tracks offset to create the checker pattern */
.checker-border .black { stroke: var(--dash-color-1); stroke-dashoffset: 0; }
.checker-border .white { stroke: var(--dash-color-2); stroke-dashoffset: var(--cell); }

/* Animate only on hover */
.grid-listing > .block:hover .checker-border { opacity: 1; }
.grid-listing > .block:hover .black { animation: marchBlack var(--speed) linear infinite; }
.grid-listing > .block:hover .white { animation: marchWhite var(--speed) linear infinite; }
.grid-listing > .block:hover .block-border { border-color: transparent; }

/* Move both colors by exactly one full pattern length (dash + gap) */
@keyframes marchBlack {
  to { stroke-dashoffset: calc(-1 * (var(--cell) * 2)); }
}
/* White track starts offset by one cell, so end at -cell to move the same distance */
@keyframes marchWhite {
  to { stroke-dashoffset: calc(-1 * var(--cell)); }
}

.grid-listing-header {
  z-index: 0;

  & .tags > .tag {
    color: var(--tag-header-text-color);
    background-color: var(--tag-header-background-color);
    /* &:hover {
      background-color: var(--tag-header-hover-background-color);
      color: var(--tag-header-hover-text-color);
    }
    &.active {
      background-color: var(--tag-header-active-background-color);
      color: var(--tag-header-active-text-color);
    } */
  }
}

.fixed-header {
  position: fixed;
  width: 100%;
  top: calc(var(--header-row) * (var(--block-height) + var(--block-gap)));
  height: var(--block-height);
  pointer-events: none;
  z-index: 0;

  border: 10px solid transparent;

  /* Hide initially until first resize */
  opacity: 0;
  transition: opacity 300ms ease-in-out;
}

/* Show all fixed headers after layout is ready */
.layout-ready .fixed-header { opacity: 1; }

/* Only fade-in the main header (.grid-listing-header) with a small delay */
@keyframes headerFadeIn { from { opacity: 0; } to { opacity: 1; } }
.layout-ready .grid-listing-header.fixed-header {
  animation-name: headerFadeIn;
  animation-duration: 200ms;
  animation-timing-function: ease-out;
  animation-fill-mode: both;
  animation-delay: var(--header-fade-delay, 1000ms);
}

/**
 * Measure viewport element used to calculate the size of blocks to be rendered on the site
 */
.grid-listing-measure {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100svh;
  /* Draw grid gaps as lines, sized by --block-gap and spaced by block size */
  background-image:
    repeating-linear-gradient(
      to right,
      transparent 0,
      transparent var(--block-width),
      var(--grid-color-vertical) var(--block-width),
      var(--grid-color-vertical) calc(var(--block-width) + var(--block-gap))
    ),
    repeating-linear-gradient(
      to bottom,
      transparent 0,
      transparent var(--block-height),
      var(--grid-color-horizontal) var(--block-height),
      var(--grid-color-horizontal) calc(var(--block-height) + var(--block-gap))
    );
  background-blend-mode: normal;
  background-repeat: repeat;
  background-position: 0 0;
  background-size: auto;

  z-index: 0;

  pointer-events: none;
  user-select: none;
  -webkit-user-select: none;
  -webkit-user-drag: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;

  /* Hide grid initially until first resize */
  opacity: 0;
  transition: opacity 300ms ease-in-out;
}

/* Show background grid after layout is ready */
.layout-ready .grid-listing-measure {
  opacity: 1;
}

/* Fade animations for blocks (independent of transform transitions) */
@keyframes fadeInQuick {
  from { opacity: 0; scale: 0.9; }
  to { opacity: 1; scale: 1; }
}
@keyframes fadeOutQuick {
  from { opacity: 1; scale: 1; }
  to { opacity: 0; scale: 0.9; }
}

.grid-listing > .block.fade-in {
  animation-name: fadeInQuick;
  animation-duration: var(--fade-in-duration);
  animation-timing-function: ease-out;
  animation-fill-mode: both;
  animation-delay: var(--fade-delay, 0ms);
}

.grid-listing > .block.fade-out {
  animation-name: fadeOutQuick;
  animation-duration: var(--fade-out-duration);
  animation-timing-function: ease-in;
  animation-fill-mode: both;
  pointer-events: none;
  animation-delay: 0ms;
}
